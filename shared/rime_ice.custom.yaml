# Nanomouse 拼音优化配置
# 适用于：雾凇拼音 (rime-ice)
# https://github.com/xjwhnxjwhn/nanomouse

patch:
  "speller/algebra/+":
    # 禁用会导致纠错规则被分词的音节（只禁用非常用音节）
    - erase/^hi$/   # hi 不是标准普通话拼音，可以安全禁用

    # 后鼻音简化：ng → nn
    - derive/ng$/nn/
    # 纠错：强力锁定音节映射，防止分词器切分（针对 S/D 邻居键误触）
    - derive/^shi$/dhi/
    - derive/^sha$/dha/
    - derive/^shu$/dhu/
    - derive/^she$/dhe/
    - derive/^shai$/dhai/
    - derive/^shei$/dhei/
    - derive/^shao$/dhao/
    - derive/^shou$/dhou/
    - derive/^shan$/dhan/
    - derive/^shen$/dhen/
    - derive/^shang$/dhang/
    - derive/^sheng$/dheng/
    - derive/^shua$/dhua/
    - derive/^shuan$/dhuan/
    - derive/^shuang$/dhuang/
    - derive/^shui$/dhui/
    - derive/^shuai$/dhuai/
    - derive/^sh/dh/
    - abbrev/^sh/dh/

    # ========== 纠错规则 ==========
    # 让纠错用的"伪声母"被识别为整体，防止被分词
    - abbrev/^(xh).+/$1/
    - abbrev/^(vh).+/$1/
    - abbrev/^(ah).+/$1/

    # 纠错：J/H 邻键误触 (sjan → shan)
    - derive/^shan$/sjan/

    # 纠错：I/O 邻键误触 (yai → yao)
    - derive/^yao$/yai/

    # 纠错：Y/T 邻键误触 (yai → tai)
    - derive/^tai$/yai/

    # 纠错：W/Q 邻键误触 (wian → qian)
    - derive/^qian$/wian/

    # 纠错：R/E 邻键误触 (chr → che)
    - derive/^che$/chr/

    # 纠错：X/Z 邻键误触 (xh* → zh*) - 18 条
    - derive/^zhi$/xhi/
    - derive/^zha$/xha/
    - derive/^zhe$/xhe/
    - derive/^zhu$/xhu/
    - derive/^zhai$/xhai/
    - derive/^zhei$/xhei/
    - derive/^zhao$/xhao/
    - derive/^zhou$/xhou/
    - derive/^zhan$/xhan/
    - derive/^zhen$/xhen/
    - derive/^zhang$/xhang/
    - derive/^zheng$/xheng/
    - derive/^zhua$/xhua/
    - derive/^zhuan$/xhuan/
    - derive/^zhuang$/xhuang/
    - derive/^zhui$/xhui/
    - derive/^zhuo$/xhuo/
    - derive/^zhuai$/xhuai/

    # 纠错：X/C 邻键误触 (xh* → ch*) - 17 条
    - derive/^chi$/xhi/
    - derive/^cha$/xha/
    - derive/^che$/xhe/
    - derive/^chu$/xhu/
    - derive/^chai$/xhai/
    - derive/^chao$/xhao/
    - derive/^chou$/xhou/
    - derive/^chan$/xhan/
    - derive/^chen$/xhen/
    - derive/^chang$/xhang/
    - derive/^cheng$/xheng/
    - derive/^chua$/xhua/
    - derive/^chuan$/xhuan/
    - derive/^chuang$/xhuang/
    - derive/^chui$/xhui/
    - derive/^chuo$/xhuo/
    - derive/^chuai$/xhuai/

    # 纠错：V/C 邻键误触 (vh* → ch*) - 17 条
    - derive/^chi$/vhi/
    - derive/^cha$/vha/
    - derive/^che$/vhe/
    - derive/^chu$/vhu/
    - derive/^chai$/vhai/
    - derive/^chao$/vhao/
    - derive/^chou$/vhou/
    - derive/^chan$/vhan/
    - derive/^chen$/vhen/
    - derive/^chang$/vhang/
    - derive/^cheng$/vheng/
    - derive/^chua$/vhua/
    - derive/^chuan$/vhuan/
    - derive/^chuang$/vhuang/
    - derive/^chui$/vhui/
    - derive/^chuo$/vhuo/
    - derive/^chuai$/vhuai/

    # 纠错：Z/X 邻键误触 (zia* → xia* 等)
    - derive/^xia$/zia/
    - derive/^xian$/zian/
    - derive/^xiang$/ziang/
    - derive/^xiao$/ziao/
    - derive/^xie$/zie/
    - derive/^xin$/zin/
    - derive/^xing$/zing/
    - derive/^xiu$/ziu/
    - derive/^xue$/zue/

    # 纠错：C/X 邻键误触 (cia* → xia* 等)
    - derive/^xia$/cia/
    - derive/^xian$/cian/
    - derive/^xiang$/ciang/
    - derive/^xiao$/ciao/
    - derive/^xie$/cie/
    - derive/^xin$/cin/
    - derive/^xing$/cing/
    - derive/^xiu$/ciu/
    - derive/^xue$/cue/

    # 纠错：I/O 邻键误触 (yiu → you)
    - derive/^you$/yiu/

    # 纠错：A/S 邻键误触 (ah* → sh*) - 18 条
    - derive/^shi$/ahi/
    - derive/^sha$/aha/
    - derive/^she$/ahe/
    - derive/^shu$/ahu/
    - derive/^shai$/ahai/
    - derive/^shei$/ahei/
    - derive/^shao$/ahao/
    - derive/^shou$/ahou/
    - derive/^shan$/ahan/
    - derive/^shen$/ahen/
    - derive/^shang$/ahang/
    - derive/^sheng$/aheng/
    - derive/^shua$/ahua/
    - derive/^shuan$/ahuan/
    - derive/^shuang$/ahuang/
    - derive/^shui$/ahui/
    - derive/^shuo$/ahuo/
    - derive/^shuai$/ahuai/

    # ========== 纠错规则结束 ==========

    # 键位优化：uan → vn
    - derive/uan$/vn/
    # 键位优化：uang → vnn
    - derive/uang$/vnn/

  # 避免 v 开头误触被 symbols_v 拦截；允许 vh* 走拼音纠错
  "recognizer/patterns/punct": "^v([0-9]|10|[A-GI-Za-gi-z][A-Za-z]*)$"
